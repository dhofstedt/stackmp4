<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DICOM-like Image Viewer</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom CSS for better styling */
    #sliderThumb {
      transition: top 0.1s ease-in-out;
    }
    #sliderThumb:hover {
      background-color: #ddd;
    }
  </style>
</head>
<body class="bg-gray-900 text-white">
  <div class="max-w-3xl mx-auto p-4">
    <!-- File Upload Input with ARIA label -->
    <label for="fileInput" class="block mb-2 text-sm font-medium text-gray-300">Upload Images</label>
    <input
      type="file"
      id="fileInput"
      multiple
      accept="image/*"
      class="mb-4 block w-full text-gray-900 bg-gray-200 rounded border border-gray-300 focus:outline-none"
      aria-label="Upload images"
    />
    <!-- Image Viewer Container -->
    <div
      id="viewer"
      class="relative w-full h-[500px] bg-black flex items-center justify-center overflow-hidden"
      role="region"
      aria-live="polite"
    >
      <!-- Placeholder text shown when no images have been uploaded -->
      <span id="placeholder" class="text-gray-400">
        Please upload images to view
      </span>
      <!-- Image element (initially hidden) -->
      <img
        id="imageDisplay"
        src=""
        alt="Image Viewer"
        class="absolute inset-0 object-contain w-full h-full hidden"
        aria-live="polite"
      />
      <!-- Vertical Slider (hidden until images are uploaded) -->
      <div
        id="sliderContainer"
        class="absolute right-4 top-0 bottom-0 flex items-center hidden"
        aria-label="Image slider"
      >
        <!-- Slider track -->
        <div
          id="sliderTrack"
          class="w-2 bg-gray-600 rounded-full relative h-full cursor-pointer"
          role="slider"
          aria-valuemin="0"
          aria-valuemax="100"
          aria-valuenow="0"
          tabindex="0"
        >
          <!-- Slider thumb -->
          <div
            id="sliderThumb"
            class="w-4 h-4 bg-white rounded-full absolute cursor-pointer"
            style="left: -1px; top: 0;"
            role="slider"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="0"
            tabindex="0"
          ></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Wait for the DOM to be fully loaded
    document.addEventListener("DOMContentLoaded", function () {
      let imageList = [];
      let currentIndex = 0;
      let dragging = false;
      // Get references to DOM elements
      const fileInput = document.getElementById("fileInput");
      const viewer = document.getElementById("viewer");
      const placeholder = document.getElementById("placeholder");
      const imageDisplay = document.getElementById("imageDisplay");
      const sliderContainer = document.getElementById("sliderContainer");
      const sliderTrack = document.getElementById("sliderTrack");
      const sliderThumb = document.getElementById("sliderThumb");
      // When the user uploads filesâ€¦
      fileInput.addEventListener("change", function (e) {
        const files = Array.from(e.target.files);
        if (files.length === 0) return;
        // Sort files by extracting numbers from their names.
        files.sort((a, b) => {
          const matchA = a.name.match(/\d+/);
          const matchB = b.name.match(/\d+/);
          if (matchA && matchB) {
            return parseInt(matchA[0]) - parseInt(matchB[0]);
          } else if (matchA) {
            return -1;
          } else if (matchB) {
            return 1;
          } else {
            return a.name.localeCompare(b.name);
          }
        });
        // Create an array of image objects with a name and an object URL.
        imageList = files.map((file) => ({
          name: file.name,
          url: URL.createObjectURL(file),
        }));
        // Start at the first image.
        currentIndex = 0;
        updateImage();
      });
      // Updates the displayed image and the slider thumb position.
      function updateImage() {
        if (imageList.length > 0) {
          placeholder.classList.add("hidden");
          imageDisplay.src = imageList[currentIndex].url;
          imageDisplay.classList.remove("hidden");
          sliderContainer.classList.remove("hidden");
        } else {
          placeholder.classList.remove("hidden");
          imageDisplay.src = "";
          imageDisplay.classList.add("hidden");
          sliderContainer.classList.add("hidden");
        }
        if (!dragging) {
          updateSliderThumb();
        }
      }
      // Listen for mouse wheel events on the viewer for navigation.
      viewer.addEventListener("wheel", function (e) {
        if (imageList.length === 0) return;
        e.preventDefault();
        if (e.deltaY > 0) {
          if (currentIndex < imageList.length - 1) {
            currentIndex++;
            updateImage();
          }
        } else if (e.deltaY < 0) {
          if (currentIndex > 0) {
            currentIndex--;
            updateImage();
          }
        }
      });
      // Calculate and set the slider thumb's vertical position.
      function updateSliderThumb() {
        if (imageList.length === 0) {
          sliderThumb.style.top = "0px";
          return;
        }
        const trackHeight = sliderTrack.clientHeight;
        const thumbHeight = sliderThumb.clientHeight;
        const maxTop = trackHeight - thumbHeight;
        let newTop = 0;
        if (imageList.length > 1) {
          newTop = (currentIndex / (imageList.length - 1)) * maxTop;
        }
        sliderThumb.style.top = newTop + "px";
        sliderThumb.setAttribute("aria-valuenow", (currentIndex / (imageList.length - 1)) * 100);
        sliderTrack.setAttribute("aria-valuenow", (currentIndex / (imageList.length - 1)) * 100);
      }
      // Enable dragging of the slider thumb.
      sliderThumb.addEventListener("pointerdown", function (e) {
        e.preventDefault();
        dragging = true;
        sliderThumb.setPointerCapture(e.pointerId);
      });
      sliderThumb.addEventListener("pointermove", function (e) {
        if (!dragging) return;
        e.preventDefault();
        const trackRect = sliderTrack.getBoundingClientRect();
        const thumbHeight = sliderThumb.clientHeight;
        const trackHeight = sliderTrack.clientHeight;
        const maxTop = trackHeight - thumbHeight;
        let offsetY = e.clientY - trackRect.top;
        let newTop = offsetY - thumbHeight / 2;
        newTop = Math.max(0, Math.min(newTop, maxTop));
        sliderThumb.style.top = newTop + "px";
        const ratio = newTop / maxTop;
        const newIndex = Math.round(ratio * (imageList.length - 1));
        if (newIndex !== currentIndex) {
          currentIndex = newIndex;
          imageDisplay.src = imageList[currentIndex].url;
        }
      });
      sliderThumb.addEventListener("pointerup", function (e) {
        dragging = false;
        sliderThumb.releasePointerCapture(e.pointerId);
        updateSliderThumb();
      });
      sliderThumb.addEventListener("pointercancel", function (e) {
        dragging = false;
        updateSliderThumb();
      });
      // Allow clicking on the slider track.
      sliderTrack.addEventListener("click", function (e) {
        if (imageList.length === 0) return;
        const trackRect = sliderTrack.getBoundingClientRect();
        const thumbHeight = sliderThumb.clientHeight;
        const trackHeight = sliderTrack.clientHeight;
        const maxTop = trackHeight - thumbHeight;
        let offsetY = e.clientY - trackRect.top;
        let newTop = offsetY - thumbHeight / 2;
        newTop = Math.max(0, Math.min(newTop, maxTop));
        sliderThumb.style.top = newTop + "px";
        const ratio = newTop / maxTop;
        currentIndex = Math.round(ratio * (imageList.length - 1));
        updateImage();
      });
      // Add keyboard navigation.
      document.addEventListener("keydown", function (e) {
        if (imageList.length === 0) return;
        if (e.key === "ArrowUp" && currentIndex > 0) {
          currentIndex--;
          updateImage();
        } else if (e.key === "ArrowDown" && currentIndex < imageList.length - 1) {
          currentIndex++;
          updateImage();
        }
      });
      // Clean up object URLs when no longer needed.
      window.addEventListener("beforeunload", function () {
        imageList.forEach((image) => URL.revokeObjectURL(image.url));
      });
    });
  </script>
</body>
</html>
